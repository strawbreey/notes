---
title: "Mysql Character"
date: 2020-09-08T16:08:54+08:00
draft: false
---

mysql 字符集选择

对数据库来说，字符集更加重要，因为数据库存储的数据大部分都是各种文字，字符集对数据库的存储，处理性能，以及日后系统的移植，推广都会有影响。
MySQL5.6目前支持几十种字符集，包括UCS-2，UTF-16，UTF-16LE,UTF-32，UTF-8和utf8mb4等Unicode字符集。
根据应用的需求，考虑以下几方面的因素。

- 满足应用支持语言的需求，如果应用要处理各种各样的文字，或者将发布到使用不同语言的国家或地区，就应该选择Unicode字符集。对MySQL来说，目前就是UTF-8
如果应用中涉及已有数据的导入，就要充分考虑数据库字符集对已有数据的兼容性。假如已有数据是GBK文字，如果选择GB2312-80为数据库字符集，就很有可能出现某些文字无法正确导入的问题

- 如果数据库只支持一般中文，数据量很大，性能要求也很高，那就应该选择双字节长编码的中文字符集，比如GBK。因为，相对于UTF-8而言，GBK比较“小”，每个汉字只占2个字节，而UTF-8汉字编码需要3个字节，这样可以减少磁盘I/O，数据库Cache以及网络传输的时间，从而提高性能。相反，如果应用主要处理英文字符，仅有少量汉字数据，那么选择UTF-8更好，因为GBK,UCS-2，UTF-16的西文字符编码都是2个字节，会造成很多不必要的开销。

- 如果数据库需要做大量的字符运算，如比较，排序等，那么选择定长字符集可能更好，因为定长字符集的处理速度要比变长字符集的处理速度快。

- 如果所有客户端程序都支持相同的字符集，则应该优先选择该字符集作为数据库字符集，这样可以避免因字符集转换带来的性能开销和数据损失


DB字符集建议都使用utf8mb4/utf8, 表字符集建议都使用utf8mb4/utf8 

库表字符集需统一,单个实例的所有库/表/字段的字符集唯一，同一个实例中不允许出现多个字符集

### 字节长度

在MySQL中，char和varchar都是用来存储字符串的，区别在于char有固定的长度，而varchar属于可变长的字符类型。
char有固定的的长度，所以在处理速度上要比varchar快很多，但是也相对更耗费存储空间，在速度上有要求的可以使用char类型。

- char类型是规定多少字长则必须存储多少字长，超过的字段则只能截取出对应的长度进行存储，相对于要去字长长度不够的字段则用空格补齐。

- varchar类型则是只要在规定字长之内，有多少就存多少，无需补齐；超出部分和char一样，舍去即可。（由prefix实现）

#### 容量区别

对于char类型来说，最多只能存放的字符个数为255，和编码无关。每个字符占用两个字节，部分中文无法显示

varchar最多能存放65532个字符，varchar的最大有效长度由最大行大小和使用的字符集来确定，整体最大长度是65532个字符。 varchar是动态长度，所以每个字符占按UTF-8占用

在version4之前，MySQL中varchar长度是按字节；而version5之后，按字符。如varchar(6), 在version4，表示占用6个字节，而在version5中，表示占用6个字符。 


而字符和字节的换算，则与编码方式有关，不同的字符所占的字节是不同的。：

ASCII码： 一个英文字母（不分大小写）占一个字节的空间，一个中文汉字占两个字节的空间。一个二进制数字序列，在计算机中作为一个数字单元，一般为8位二进制数，换算为十进制。最小值0，最大值255。如一个ASCII码就是一个字节。 (一个英文字母1个字节，tinyint 一个字节)


UTF-8编码： 一个英文字符等于一个字节，一个中文占三个字节， 扩展B区以后的汉字占四个字节。

Unicode编码： 一个英文等于两个字节，一个中文（含繁体）等于两个字节。

GBK编码，一个汉字占两个字节。

UTF-16编码，通常汉字占两个字节，CJKV扩展B区、扩展C区、扩展D区中的汉字占四个字节（一般字符的Unicode范围是U+0000至U+FFFF，而这些扩展部分的范围大于U+20000，因而要用两个UTF-16）。


