<!DOCTYPE html>
<html><head>
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

   
    <meta name="author" content="strawbreey">
  

   
    
    
    
    
    
    
    <meta name="keywords" content="theme,kagome">
  

  

  <meta name="generator" content="Hugo 0.86.0" />
  
  
  
  
  
  
  <title>Go Deploy ğŸŒŸ å¦‚æ²æ˜¥é£</title>

  <meta property="og:title" content="Go Deploy" />
<meta property="og:description" content="éƒ¨ç½²Goè¯­è¨€é¡¹ç›®çš„ N ç§æ–¹æ³• ç‹¬ç«‹éƒ¨ç½² Go è¯­è¨€æ”¯æŒè·¨å¹³å°äº¤å‰ç¼–è¯‘ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨ Windows æˆ– Mac å¹³å°ä¸‹ç¼–å†™ä»£ç ï¼Œå¹¶ä¸”å°†ä»£ç ç¼–è¯‘æˆèƒ½å¤Ÿåœ¨ Linux amd64 æœåŠ¡å™¨ä¸Šè¿è¡Œçš„" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://note.strawbreey.com/posts/202108182010/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-18T20:10:17+08:00" />
<meta property="article:modified_time" content="2021-08-18T20:10:17+08:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go Deploy"/>
<meta name="twitter:description" content="éƒ¨ç½²Goè¯­è¨€é¡¹ç›®çš„ N ç§æ–¹æ³• ç‹¬ç«‹éƒ¨ç½² Go è¯­è¨€æ”¯æŒè·¨å¹³å°äº¤å‰ç¼–è¯‘ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨ Windows æˆ– Mac å¹³å°ä¸‹ç¼–å†™ä»£ç ï¼Œå¹¶ä¸”å°†ä»£ç ç¼–è¯‘æˆèƒ½å¤Ÿåœ¨ Linux amd64 æœåŠ¡å™¨ä¸Šè¿è¡Œçš„"/>


  <link href="https://note.strawbreey.com/css/index.css" rel="stylesheet">    

  <script src="https://note.strawbreey.com/js/main.js" ></script>
  
  </head><body><header class="header-container layout-block layout-padding">
  <div class="header-inner content-padding-large soft-size--large soft-style--box">
    <div class="header-logo">
      <a href="https://note.strawbreey.com"><h1>å¦‚æ²æ˜¥é£</h1></a>
    </div>
    <nav class="header-nav">
      <div class="header-nav--btn">
        <div class="btn-item"></div>
        <div class="btn-item"></div>
        <div class="btn-item"></div>
      </div>
      <div class="header-nav--list">
        <div>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/" title="">HOME</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/posts" title="">POSTS</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/message" title="">MESSAGE</a>
          
          <a class="list-item soft-size--small soft-style--hover soft-style--active" href="/link" title="">LINK</a>
          
        </div>
      </div>
    </nav>
  </div>
</header><main id="content">
    

    <div class="single-container layout-block">
      <div class="article-info">
        <div class="article-header layout-padding">
          <div class="article-cover card-container content-padding-large soft-size--large soft-style--box img ">

  <div class="card-cover">
    
      <img src="https://note.strawbreey.com/cover/1.jpg" alt="/cover/1.jpg" />
    
  </div>

  <div class="card-text">
    <h1 class="card-text--title">Go Deploy</h1>
    
      <p class="card-text--row">2021-08-18 20:10</p>
      
      
      

      
      
    
  </div>

</div>
        </div>

        <div class="article-content">
          <div class="markdown-body content-padding-large soft-size--large soft-style--box">
            <h3 id="éƒ¨ç½²goè¯­è¨€é¡¹ç›®çš„-n-ç§æ–¹æ³•">éƒ¨ç½²Goè¯­è¨€é¡¹ç›®çš„ N ç§æ–¹æ³•</h3>
<h3 id="ç‹¬ç«‹éƒ¨ç½²">ç‹¬ç«‹éƒ¨ç½²</h3>
<p>Go è¯­è¨€æ”¯æŒè·¨å¹³å°äº¤å‰ç¼–è¯‘ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥åœ¨ Windows æˆ– Mac å¹³å°ä¸‹ç¼–å†™ä»£ç ï¼Œå¹¶ä¸”å°†ä»£ç ç¼–è¯‘æˆèƒ½å¤Ÿåœ¨ Linux amd64 æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ç¨‹åºã€‚</p>
<p>å¯¹äºç®€å•çš„é¡¹ç›®ï¼Œé€šå¸¸æˆ‘ä»¬åªéœ€è¦å°†ç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶æ‹·è´åˆ°æœåŠ¡å™¨ä¸Šï¼Œç„¶åè®¾ç½®ä¸ºåå°å®ˆæŠ¤è¿›ç¨‹è¿è¡Œå³å¯ã€‚</p>
<h3 id="ç¼–è¯‘">ç¼–è¯‘</h3>
<p>ç¼–è¯‘å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æˆ–ç¼–å†™ makefile æ¥æ“ä½œã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOOS<span style="color:#f92672">=</span>linux GOARCH<span style="color:#f92672">=</span>amd64 go build -o ./bin/bluebell
</code></pre></div><p>ä¸‹é¢å‡è®¾æˆ‘ä»¬å°†æœ¬åœ°ç¼–è¯‘å¥½çš„ bluebell äºŒè¿›åˆ¶æ–‡ä»¶ã€é…ç½®æ–‡ä»¶å’Œé™æ€æ–‡ä»¶ç­‰ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„/data/app/bluebellç›®å½•ä¸‹ã€‚</p>
<p>è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœå«Œå¼ƒç¼–è¯‘åçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤ªå¤§ï¼Œå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š-ldflags &ldquo;-s -w&quot;å‚æ•°å»æ‰ç¬¦å·è¡¨å’Œè°ƒè¯•ä¿¡æ¯ï¼Œä¸€èˆ¬èƒ½å‡å°20%çš„å¤§å°ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOOS<span style="color:#f92672">=</span>linux GOARCH<span style="color:#f92672">=</span>amd64 go build -ldflags <span style="color:#e6db74">&#34;-s -w&#34;</span> -o ./bin/bluebell
</code></pre></div><p>å¦‚æœè¿˜æ˜¯å«Œå¤§çš„è¯å¯ä»¥ç»§ç»­ä½¿ç”¨ upx å·¥å…·å¯¹äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œå‹ç¼©ã€‚</p>
<p>æˆ‘ä»¬ç¼–è¯‘å¥½ bluebell é¡¹ç›®åï¼Œç›¸å…³å¿…è¦æ–‡ä»¶çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">â”œâ”€â”€ bin
â”‚   â””â”€â”€ bluebell
â”œâ”€â”€ conf
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ static
â”‚   â”œâ”€â”€ css
â”‚   â”‚   â””â”€â”€ app.0afe9dae.css
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â”œâ”€â”€ img
â”‚   â”‚   â”œâ”€â”€ avatar.7b0a9835.png
â”‚   â”‚   â”œâ”€â”€ iconfont.cdbe38a0.svg
â”‚   â”‚   â”œâ”€â”€ logo.da56125f.png
â”‚   â”‚   â””â”€â”€ search.8e85063d.png
â”‚   â””â”€â”€ js
â”‚       â”œâ”€â”€ app.9f3efa6d.js
â”‚       â”œâ”€â”€ app.9f3efa6d.js.map
â”‚       â”œâ”€â”€ chunk-vendors.57f9e9d6.js
â”‚       â””â”€â”€ chunk-vendors.57f9e9d6.js.map
â””â”€â”€ templates
    â””â”€â”€ index.html
</code></pre></div><h3 id="nohup">nohup</h3>
<p>nohup ç”¨äºåœ¨ç³»ç»Ÿåå°ä¸æŒ‚æ–­åœ°è¿è¡Œå‘½ä»¤ï¼Œä¸æŒ‚æ–­æŒ‡çš„æ˜¯é€€å‡ºæ‰§è¡Œå‘½ä»¤çš„ç»ˆç«¯ä¹Ÿä¸ä¼šå½±å“ç¨‹åºçš„è¿è¡Œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nohup å‘½ä»¤æ¥è¿è¡Œåº”ç”¨ç¨‹åºï¼Œä½¿å…¶ä½œä¸ºåå°å®ˆæŠ¤è¿›ç¨‹è¿è¡Œã€‚ç”±äºåœ¨ä¸»æµçš„ Linux å‘è¡Œç‰ˆä¸­éƒ½ä¼šé»˜è®¤å®‰è£… nohup å‘½ä»¤å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨æˆ‘ä»¬çš„é¡¹ç›®ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo nohup ./bin/bluebell conf/config.yaml &gt; nohup_bluebell.log 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp;
</code></pre></div><p>å…¶ä¸­ï¼š</p>
<p>./bluebell conf/config.yamlæ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å¯åŠ¨å‘½ä»¤
nohup &hellip; &amp;è¡¨ç¤ºåœ¨åå°ä¸æŒ‚æ–­çš„æ‰§è¡Œä¸Šè¿°åº”ç”¨ç¨‹åºçš„å¯åŠ¨å‘½ä»¤</p>
<blockquote>
<p>nohup_bluebell.logè¡¨ç¤ºå°†å‘½ä»¤çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ° nohup_bluebell.log æ–‡ä»¶
2&gt;&amp;1è¡¨ç¤ºå°†æ ‡å‡†é”™è¯¯è¾“å‡ºä¹Ÿé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºä¸­ï¼Œç»“åˆä¸Šä¸€æ¡å°±æ˜¯æŠŠæ‰§è¡Œå‘½ä»¤çš„è¾“å‡ºéƒ½å®šå‘åˆ° nohup_bluebell.log æ–‡ä»¶
ä¸Šé¢çš„å‘½ä»¤æ‰§è¡Œåä¼šè¿”å›è¿›ç¨‹ id</p>
</blockquote>
<p>[1] 6338
å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ bluebell ç›¸å…³æ´»åŠ¨è¿›ç¨‹ï¼š</p>
<p>ps -ef | grep bluebell
è¾“å‡ºï¼š</p>
<p>root      6338  4048  0 08:43 pts/0    00:00:00 ./bin/bluebell conf/config.yaml
root      6376  4048  0 08:43 pts/0    00:00:00 grep &ndash;color=auto bluebell
æ­¤æ—¶å°±å¯ä»¥æ‰“å¼€æµè§ˆå™¨è¾“å…¥http://æœåŠ¡å™¨å…¬ç½‘ip:ç«¯å£æŸ¥çœ‹åº”ç”¨ç¨‹åºçš„å±•ç¤ºæ•ˆæœäº†ã€‚</p>
<h3 id="supervisor">supervisor</h3>
<p>Supervisor æ˜¯ä¸šç•Œæµè¡Œçš„ä¸€ä¸ªé€šç”¨çš„è¿›ç¨‹ç®¡ç†ç¨‹åºï¼Œå®ƒèƒ½å°†ä¸€ä¸ªæ™®é€šçš„å‘½ä»¤è¡Œè¿›ç¨‹å˜ä¸ºåå°å®ˆæŠ¤è¿›ç¨‹ï¼Œå¹¶ç›‘æ§è¯¥è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå½“è¯¥è¿›ç¨‹å¼‚å¸¸é€€å‡ºæ—¶èƒ½å°†å…¶è‡ªåŠ¨é‡å¯ã€‚</p>
<p>é¦–å…ˆä½¿ç”¨ yum æ¥å®‰è£… supervisorï¼š</p>
<p>å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…è¿‡ EPELï¼Œå¯ä»¥é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®Œæˆå®‰è£…ï¼Œå¦‚æœå·²å®‰è£…åˆ™è·³è¿‡æ­¤æ­¥éª¤ï¼š</p>
<pre><code>sudo yum install epel-release
å®‰è£… supervisor

sudo yum install supervisor
Supervisor çš„é…ç½®æ–‡ä»¶ä¸ºï¼š/etc/supervisord.conf ï¼ŒSupervisor æ‰€ç®¡ç†çš„åº”ç”¨çš„é…ç½®æ–‡ä»¶æ”¾åœ¨ /etc/supervisord.d/ ç›®å½•ä¸­ï¼Œè¿™ä¸ªç›®å½•å¯ä»¥åœ¨ supervisord.conf ä¸­çš„includeé…ç½®ã€‚
</code></pre><p>[include]
files = /etc/supervisord.d/*.conf
å¯åŠ¨supervisoræœåŠ¡ï¼š</p>
<p>sudo supervisord -c /etc/supervisord.conf
æˆ‘ä»¬åœ¨/etc/supervisord.dç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºbluebell.confçš„é…ç½®æ–‡ä»¶ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ã€‚</p>
<p>[program:bluebell]  ;ç¨‹åºåç§°
user=root  ;æ‰§è¡Œç¨‹åºçš„ç”¨æˆ·
command=/data/app/bluebell/bin/bluebell /data/app/bluebell/conf/config.yaml  ;æ‰§è¡Œçš„å‘½ä»¤
directory=/data/app/bluebell/ ;å‘½ä»¤æ‰§è¡Œçš„ç›®å½•
stopsignal=TERM  ;é‡å¯æ—¶å‘é€çš„ä¿¡å·
autostart=true<br>
autorestart=true  ;æ˜¯å¦è‡ªåŠ¨é‡å¯
stdout_logfile=/var/log/bluebell-stdout.log  ;æ ‡å‡†è¾“å‡ºæ—¥å¿—ä½ç½®
stderr_logfile=/var/log/bluebell-stderr.log  ;æ ‡å‡†é”™è¯¯æ—¥å¿—ä½ç½®
åˆ›å»ºå¥½é…ç½®æ–‡ä»¶ä¹‹åï¼Œé‡å¯supervisoræœåŠ¡</p>
<p>sudo supervisorctl update # æ›´æ–°é…ç½®æ–‡ä»¶å¹¶é‡å¯ç›¸å…³çš„ç¨‹åº
æŸ¥çœ‹bluebellçš„è¿è¡ŒçŠ¶æ€ï¼š</p>
<p>sudo supervisorctl status bluebell
è¾“å‡ºï¼š</p>
<p>bluebell                         RUNNING   pid 10918, uptime 0:05:46
æœ€åè¡¥å……ä¸€ä¸‹å¸¸ç”¨çš„supervisrç®¡ç†å‘½ä»¤ï¼š</p>
<p>supervisorctl status       # æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡çŠ¶æ€
supervisorctl shutdown     # å…³é—­æ‰€æœ‰ä»»åŠ¡
supervisorctl start ç¨‹åºå  # å¯åŠ¨ä»»åŠ¡
supervisorctl stop ç¨‹åºå   # å…³é—­ä»»åŠ¡
supervisorctl reload       # é‡å¯supervisor
æ¥ä¸‹æ¥å°±æ˜¯æ‰“å¼€æµè§ˆå™¨æŸ¥çœ‹ç½‘ç«™æ˜¯å¦æ­£å¸¸äº†ã€‚</p>
<h3 id="æ­é…nginxéƒ¨ç½²">æ­é…nginxéƒ¨ç½²</h3>
<p>åœ¨éœ€è¦é™æ€æ–‡ä»¶åˆ†ç¦»ã€éœ€è¦é…ç½®å¤šä¸ªåŸŸååŠè¯ä¹¦ã€éœ€è¦è‡ªå»ºè´Ÿè½½å‡è¡¡å±‚ç­‰ç¨å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦æ­é…ç¬¬ä¸‰æ–¹çš„webæœåŠ¡å™¨ï¼ˆNginxã€Apacheï¼‰æ¥éƒ¨ç½²æˆ‘ä»¬çš„ç¨‹åºã€‚</p>
<h3 id="æ­£å‘ä»£ç†ä¸åå‘ä»£ç†">æ­£å‘ä»£ç†ä¸åå‘ä»£ç†</h3>
<p>æ­£å‘ä»£ç†å¯ä»¥ç®€å•ç†è§£ä¸ºå®¢æˆ·ç«¯çš„ä»£ç†ï¼Œä½ è®¿é—®å¢™å¤–çš„ç½‘ç«™ç”¨çš„é‚£ä¸ªå±äºæ­£å‘ä»£ç†ã€‚</p>
<p>åå‘ä»£ç†å¯ä»¥ç®€å•ç†è§£ä¸ºæœåŠ¡å™¨çš„ä»£ç†ï¼Œé€šå¸¸è¯´çš„ Nginx å’Œ Apache å°±å±äºåå‘ä»£ç†ã€‚</p>
<p>Nginx æ˜¯ä¸€ä¸ªå…è´¹çš„ã€å¼€æºçš„ã€é«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡ï¼Œä¸»è¦è´Ÿè´£è´Ÿè½½ä¸€äº›è®¿é—®é‡æ¯”è¾ƒå¤§çš„ç«™ç‚¹ã€‚Nginx å¯ä»¥ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ Web æœåŠ¡ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ç»™ Apache æˆ–æ˜¯å…¶ä»–çš„ Web æœåŠ¡åšåå‘ä»£ç†ã€‚ç›¸æ¯”äº Apacheï¼ŒNginx å¯ä»¥å¤„ç†æ›´å¤šçš„å¹¶å‘è¿æ¥ï¼Œè€Œä¸”æ¯ä¸ªè¿æ¥çš„å†…å­˜å ç”¨çš„éå¸¸å°ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ä½¿ç”¨yumå®‰è£…nginx
EPEL ä»“åº“ä¸­æœ‰ Nginx çš„å®‰è£…åŒ…ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…è¿‡ EPELï¼Œå¯ä»¥é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®Œæˆå®‰è£…ï¼š

sudo yum install epel-release
å®‰è£…nginx

sudo yum install nginx
å®‰è£…å®Œæˆåï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤è®¾ç½®Nginxå¼€æœºå¯åŠ¨ï¼š

sudo systemctl enable nginx
å¯åŠ¨Nginx

sudo systemctl start nginx
æŸ¥çœ‹Nginxè¿è¡ŒçŠ¶æ€ï¼š

sudo systemctl status nginx
</code></pre></div><p>Nginxé…ç½®æ–‡ä»¶</p>
<p>é€šè¿‡ä¸Šé¢çš„æ–¹æ³•å®‰è£…çš„ nginxï¼Œæ‰€æœ‰ç›¸å…³çš„é…ç½®æ–‡ä»¶éƒ½åœ¨ /etc/nginx/ ç›®å½•ä¸­ã€‚Nginx çš„ä¸»é…ç½®æ–‡ä»¶æ˜¯ /etc/nginx/nginx.confã€‚</p>
<p>é»˜è®¤è¿˜æœ‰ä¸€ä¸ªnginx.conf.defaultçš„é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒã€‚ä½ å¯ä»¥ä¸ºå¤šä¸ªæœåŠ¡åˆ›å»ºä¸åŒçš„é…ç½®æ–‡ä»¶ï¼ˆå»ºè®®ä¸ºæ¯ä¸ªæœåŠ¡ï¼ˆåŸŸåï¼‰åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼‰ï¼Œæ¯ä¸€ä¸ªç‹¬ç«‹çš„ Nginx æœåŠ¡é…ç½®æ–‡ä»¶éƒ½å¿…é¡»ä»¥ .confç»“å°¾ï¼Œå¹¶å­˜å‚¨åœ¨ /etc/nginx/conf.d ç›®å½•ä¸­ã€‚</p>
<p>Nginxå¸¸ç”¨å‘½ä»¤</p>
<p>è¡¥å……å‡ ä¸ª Nginx å¸¸ç”¨å‘½ä»¤ã€‚</p>
<p>nginx -s stop    # åœæ­¢ Nginx æœåŠ¡
nginx -s reload  # é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶
nginx -s quit    # å¹³æ»‘åœæ­¢ Nginx æœåŠ¡
nginx -t         # æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®
Nginxåå‘ä»£ç†éƒ¨ç½²
æˆ‘ä»¬æ¨èä½¿ç”¨ nginx ä½œä¸ºåå‘ä»£ç†æ¥éƒ¨ç½²æˆ‘ä»¬çš„ç¨‹åºï¼ŒæŒ‰ä¸‹é¢çš„å†…å®¹ä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶ã€‚</p>
<pre><code class="language-conf" data-lang="conf">worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;

        access_log   /var/log/bluebell-access.log;
        error_log    /var/log/bluebell-error.log;

        location / {
            proxy_pass                 http://127.0.0.1:8084;
            proxy_redirect             off;
            proxy_set_header           Host             $host;
            proxy_set_header           X-Real-IP        $remote_addr;
            proxy_set_header           X-Forwarded-For  $proxy_add_x_forwarded_for;
        }
    }
}
</code></pre><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•ï¼š</p>
<p>nginx -t</p>
<p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼š</p>
<p>nginx -s reload</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ‰“å¼€æµè§ˆå™¨æŸ¥çœ‹ç½‘ç«™æ˜¯å¦æ­£å¸¸äº†ã€‚</p>
<p>å½“ç„¶æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ nginx çš„ upstream é…ç½®æ¥æ·»åŠ å¤šä¸ªæœåŠ¡å™¨åœ°å€å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<pre><code class="language-conf" data-lang="conf">worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    upstream backend {
      server 127.0.0.1:8084;
      # è¿™é‡Œéœ€è¦å¡«çœŸå®å¯ç”¨çš„åœ°å€ï¼Œé»˜è®¤è½®è¯¢
      #server backend1.example.com;
      #server backend2.example.com;
    }

    server {
        listen       80;
        server_name  localhost;

        access_log   /var/log/bluebell-access.log;
        error_log    /var/log/bluebell-error.log;

        location / {
            proxy_pass                 http://backend/;
            proxy_redirect             off;
            proxy_set_header           Host             $host;
            proxy_set_header           X-Real-IP        $remote_addr;
            proxy_set_header           X-Forwarded-For  $proxy_add_x_forwarded_for;
        }
    }
}
</code></pre><h3 id="nginxåˆ†ç¦»é™æ€æ–‡ä»¶è¯·æ±‚">Nginxåˆ†ç¦»é™æ€æ–‡ä»¶è¯·æ±‚</h3>
<p>ä¸Šé¢çš„é…ç½®æ˜¯ç®€å•çš„ä½¿ç”¨ nginx ä½œä¸ºåå‘ä»£ç†å¤„ç†æ‰€æœ‰çš„è¯·æ±‚å¹¶è½¬å‘ç»™æˆ‘ä»¬çš„ Go ç¨‹åºå¤„ç†ï¼Œå…¶å®æˆ‘ä»¬è¿˜å¯ä»¥æœ‰é€‰æ‹©çš„å°†é™æ€æ–‡ä»¶éƒ¨åˆ†çš„è¯·æ±‚ç›´æ¥ä½¿ç”¨ nginx å¤„ç†ï¼Œè€Œå°† API æ¥å£ç±»çš„åŠ¨æ€å¤„ç†è¯·æ±‚è½¬å‘ç»™åç«¯çš„ Go ç¨‹åºæ¥å¤„ç†ã€‚</p>
<p>åˆ†ç¦»é™æ€æ–‡ä»¶è¯·æ±‚å›¾ç¤º</p>
<p>ä¸‹é¢ç»§ç»­ä¿®æ”¹æˆ‘ä»¬çš„ nginx çš„é…ç½®æ–‡ä»¶æ¥å®ç°ä¸Šè¿°åŠŸèƒ½ã€‚</p>
<p>worker_processes  1;</p>
<p>events {
worker_connections  1024;
}</p>
<p>http {
include       mime.types;
default_type  application/octet-stream;</p>
<pre><code>sendfile        on;
keepalive_timeout  65;

server {
    listen       80;
    server_name  bluebell;

    access_log   /var/log/bluebell-access.log;
    error_log    /var/log/bluebell-error.log;

	# é™æ€æ–‡ä»¶è¯·æ±‚
    location ~ .*\.(gif|jpg|jpeg|png|js|css|eot|ttf|woff|svg|otf)$ {
        access_log off;
        expires    1d;
        root       /data/app/bluebell;
    }

    # index.htmlé¡µé¢è¯·æ±‚
    # å› ä¸ºæ˜¯å•é¡µé¢åº”ç”¨è¿™é‡Œä½¿ç”¨ try_files å¤„ç†ä¸€ä¸‹ï¼Œé¿å…åˆ·æ–°é¡µé¢æ—¶å‡ºç°404çš„é—®é¢˜
    location / {
        root /data/app/bluebell/templates;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

	# APIè¯·æ±‚
    location /api {
        proxy_pass                 http://127.0.0.1:8084;
        proxy_redirect             off;
        proxy_set_header           Host             $host;
        proxy_set_header           X-Real-IP        $remote_addr;
        proxy_set_header           X-Forwarded-For  $proxy_add_x_forwarded_for;
    }
}
</code></pre>
<p>}
å‰åç«¯åˆ†å¼€éƒ¨ç½²
å‰åç«¯çš„ä»£ç æ²¡å¿…è¦éƒ½éƒ¨ç½²åˆ°ç›¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿå¯ä»¥åˆ†å¼€éƒ¨ç½²åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¸‹å›¾æ˜¯å‰ç«¯æœåŠ¡å°† API è¯·æ±‚è½¬å‘è‡³åç«¯æœåŠ¡çš„æ–¹æ¡ˆã€‚</p>
<ul>
<li>å‰åç«¯åˆ†å¼€éƒ¨ç½²æ–¹æ¡ˆ1</li>
</ul>
<p>ä¸Šé¢çš„éƒ¨ç½²æ–¹æ¡ˆä¸­ï¼Œæ‰€æœ‰æµè§ˆå™¨çš„è¯·æ±‚éƒ½æ˜¯ç›´æ¥è®¿é—®å‰ç«¯æœåŠ¡ï¼Œè€Œå¦‚æœæ˜¯æµè§ˆå™¨ç›´æ¥è®¿é—®åç«¯APIæœåŠ¡çš„éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œå¦‚ä¸‹å›¾ã€‚</p>
<p>æ­¤æ—¶å‰ç«¯å’Œåç«¯é€šå¸¸ä¸åœ¨åŒä¸€ä¸ªåŸŸä¸‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨åç«¯ä»£ç ä¸­æ·»åŠ è·¨åŸŸæ”¯æŒã€‚</p>
<ul>
<li>å‰åç«¯åˆ†å¼€éƒ¨ç½²æ–¹æ¡ˆ2</li>
</ul>
<p>è¿™é‡Œä½¿ç”¨github.com/gin-contrib/corsåº“æ¥æ”¯æŒè·¨åŸŸè¯·æ±‚ã€‚</p>
<p>æœ€ç®€å•çš„å…è®¸è·¨åŸŸçš„é…ç½®æ˜¯ä½¿ç”¨cors.Default()ï¼Œå®ƒé»˜è®¤å…è®¸æ‰€æœ‰è·¨åŸŸè¯·æ±‚ã€‚</p>
<p>func main() {
router := gin.Default()
// same as
// config := cors.DefaultConfig()
// config.AllowAllOrigins = true
// router.Use(cors.New(config))
router.Use(cors.Default())
router.Run()
}
æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨cors.Configè‡ªå®šä¹‰å…·ä½“çš„è·¨åŸŸè¯·æ±‚ç›¸å…³é…ç½®é¡¹ï¼š</p>
<p>package main</p>
<p>import (
&ldquo;time&rdquo;</p>
<pre><code>&quot;github.com/gin-contrib/cors&quot;
&quot;github.com/gin-gonic/gin&quot;
</code></pre>
<p>)</p>
<p>func main() {
router := gin.Default()
// CORS for <a href="https://foo.com" target="_blank" rel="noopener">https://foo.com</a> and <a href="https://github.com" target="_blank" rel="noopener">https://github.com</a> origins, allowing:
// - PUT and PATCH methods
// - Origin header
// - Credentials share
// - Preflight requests cached for 12 hours
router.Use(cors.New(cors.Config{
AllowOrigins:     []string{&ldquo;<a href="https://foo.com" target="_blank" rel="noopener">https://foo.com</a>&rdquo;},
AllowMethods:     []string{&ldquo;PUT&rdquo;, &ldquo;PATCH&rdquo;},
AllowHeaders:     []string{&ldquo;Origin&rdquo;},
ExposeHeaders:    []string{&ldquo;Content-Length&rdquo;},
AllowCredentials: true,
AllowOriginFunc: func(origin string) bool {
return origin == &ldquo;<a href="https://github.com" target="_blank" rel="noopener">https://github.com</a>&rdquo;
},
MaxAge: 12 * time.Hour,
}))
router.Run()
}</p>
<h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3>
<ul>
<li><a href="https://www.liwenzhou.com/posts/Go/deploy_go_app/" target="_blank" rel="noopener">https://www.liwenzhou.com/posts/Go/deploy_go_app/</a></li>
</ul>

          </div>
        </div>
                 
      
  
  
  
  

  

  <div class="article-paging">
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" ></div>
  <div class="card-text">
    <a href="/posts/202108182011/"><h4 class="card-text--title text-ellipsis">Go Deploy Docker</h4></a>
    <p class="card-text--row">2021-08-18 20:11</p>
  </div>
</section>
    
    
      <section class="post-paging--item card-container content-padding-primary soft-size--primary soft-style--box">
  <div class="card-cover" ></div>
  <div class="card-text">
    <a href="/posts/202108182001/"><h4 class="card-text--title text-ellipsis">Go Json</h4></a>
    <p class="card-text--row">2021-08-18 20:01</p>
  </div>
</section>
    
  </div>
</div>
  <aside class="widget-info">
    
<section class="aside-widget widget-author content-padding-large soft-size--large soft-style--box">
  <div class="widget-body">
    <div class="author-box avatar">
      
      <img class="author-avatar soft-size--round soft-style--box" src="/favicon.png" alt="strawbreey">
      
      <h2 class="author-name text-ellipsis">strawbreey</h2>
      
      <p class="author-desc text-ellipsis">strawbreey</p>
      
    </div>
  </div>
</section>


    


    










<section class="aside-widget widget-articles content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>Related Posts</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="post-list">
      
      
        <li class="post-item"><a href="/posts/202107261428/">Gin Start</a></li>
      
        <li class="post-item"><a href="/posts/202109031802/">Go Rune</a></li>
      
        <li class="post-item"><a href="/posts/202109011729/">Go Learn</a></li>
      
        <li class="post-item"><a href="/posts/202108261456/">Css Variables</a></li>
      
        <li class="post-item"><a href="/posts/202108241426/">Js ConcatAll</a></li>
      
        <li class="post-item"><a href="/posts/202108231542/">Php Urlencode</a></li>
      
    </ul>
  </div>
</section>


    




<section class="aside-widget widget-categories content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>Categories</span>
    </div>
  </h2>
  <div class="widget-body">
    <ul class="categories-list">
      
        <li>
          <a href="https://note.strawbreey.com/categories/go/">GO</a>
          <span>8</span>
        </li>
      
    </ul>
  </div>

  
</section>


    




<section class="aside-widget widget-tags content-padding-large soft-size--large soft-style--box">
  <h2 class="widget-header">
    <div class="title">
      <span>Tags</span>
    </div>
  </h2>
  <div class="widget-body">
    <div class="tags-list">
      
        <a href="https://note.strawbreey.com/tags/php/" data-count="23" class="soft-size--small soft-style--hover soft-style--active">php</a>
      
        <a href="https://note.strawbreey.com/tags/leetcode/" data-count="14" class="soft-size--small soft-style--hover soft-style--active">leetcode</a>
      
        <a href="https://note.strawbreey.com/tags/go/" data-count="8" class="soft-size--small soft-style--hover soft-style--active">GO</a>
      
        <a href="https://note.strawbreey.com/tags/vscode/" data-count="3" class="soft-size--small soft-style--hover soft-style--active">vscode</a>
      
        <a href="https://note.strawbreey.com/tags/git/" data-count="2" class="soft-size--small soft-style--hover soft-style--active">git</a>
      
        <a href="https://note.strawbreey.com/tags/mysql/" data-count="2" class="soft-size--small soft-style--hover soft-style--active">mysql</a>
      
        <a href="https://note.strawbreey.com/tags/webapi/" data-count="2" class="soft-size--small soft-style--hover soft-style--active">webApi</a>
      
        <a href="https://note.strawbreey.com/tags/angular/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">angular</a>
      
        <a href="https://note.strawbreey.com/tags/devops/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">devops</a>
      
        <a href="https://note.strawbreey.com/tags/interview/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">interview</a>
      
        <a href="https://note.strawbreey.com/tags/toggle/" data-count="1" class="soft-size--small soft-style--hover soft-style--active">toggle</a>
      
    </div>
  </div>

  
</section>

  </aside>
</div>
  </main><footer class="footer-container layout-block">
  
  <div class="social-icons">
    
      <a class="soft-size--primary soft-style--box" href="https://github.com/strawbreey" target="_blank" rel="noopener noreferrer">
          
        <svg class="icon icon-github" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
          <path d="M64.6 512c0 195.6 125.4 361.9 300.1 422.9 23.5 5.9 19.9-10.8 19.9-22.2v-77.6c-135.8 15.9-141.3-74-150.5-89-18.5-31.5-61.9-39.5-49-54.5 31-15.9 62.5 4 98.9 58 26.4 39.1 77.9 32.5 104.1 26 5.7-23.5 17.9-44.5 34.7-60.9-140.7-25.2-199.4-111.1-199.4-213.3 0-49.5 16.4-95.1 48.4-131.8-20.4-60.6 1.9-112.4 4.9-120.1 58.2-5.2 118.5 41.6 123.3 45.3 33.1-8.9 70.8-13.7 112.9-13.7 42.4 0 80.3 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.4-43.9 2.9 7.7 24.7 58.3 5.5 118.1 32.5 36.8 49 82.8 49 132.4 0 102.3-59 188.3-200.2 213.2 23.5 23.3 38.1 55.5 38.1 91.1v112.7c0.8 9 0 17.9 15.1 17.9C832.7 877 960.4 709.4 960.4 512.1c0-247.5-200.6-447.9-447.9-447.9C265 64.1 64.6 264.5 64.6 512z"></path>
        </svg>
        

        

        

        

        
      </a>
    
      <a class="soft-size--primary soft-style--box" href="1245788423@qq.com" target="_blank" rel="noopener noreferrer">
        

        

        

        

        
      </a>
    
  </div>
  

  <div class="colour-bar"></div>
  
  
  <p>Â© 2021 <a href="https://github.com/miiiku/hugo-theme-kagome">kagome</a>.</p>
  

  

  <p>
    Powered by
    <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a>
    Theme - 
    <a href="https://github.com/miiiku/hugo-theme-kagome" target="_blank" rel="noopener noreferrer author">kagome</a>
  </p>

  <p>
    <a href="javascript:;" id="theme-light">ğŸŒ light</a>
    <a href="javascript:;" id="theme-dark">ğŸŒ› dark</a>
    <a href="javascript:;" id="theme-auto">ğŸ¤–ï¸ auto</a>
  </p>
</footer>







</body>

</html>