<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Yii Db ::
        Strawbreey Notes
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Yii 包含了一个建立在 PHP PDO 之上的数据访问层 (DAO： Database Access Objects)。DAO为不同的数据库提供了一套统一的API。 其中 ActiveRecord 提供了数据库与模型(MVC 中的 M,Model) 的交互，QueryBuilder 用于创建动态的查询语句。 DAO提供了简单高效的SQL查询，可以用在与数据库交互的各个地方.
使用 Yii DAO 时，你主要需要处理纯 SQL 语句和 PHP 数组。因此，这是访问数据库最高效的方法。 然而，因为不同数据库之间的 SQL 语法往往是不同的， 使用 Yii DAO 也意味着你必须花些额外的工夫来创建一个”数据库无关“的应用。
连接数据库 // 连接数据库$db = new yii\db\Connection([&amp;#39;dsn&amp;#39; =&amp;gt; &amp;#39;mysql:host=localhost;dbname=example&amp;#39;,&amp;#39;username&amp;#39; =&amp;gt; &amp;#39;root&amp;#39;,&amp;#39;password&amp;#39; =&amp;gt; &amp;#39;&amp;#39;,&amp;#39;charset&amp;#39; =&amp;gt; &amp;#39;utf8&amp;#39;,]);return [&amp;#39;components&amp;#39; =&amp;gt; [&amp;#39;db&amp;#39; =&amp;gt; [&amp;#39;class&amp;#39; =&amp;gt; &amp;#39;yii\db\Connection&amp;#39;,&amp;#39;dsn&amp;#39; =&amp;gt; &amp;#39;mysql:host=localhost;dbname=example&amp;#39;,&amp;#39;username&amp;#39; =&amp;gt; &amp;#39;root&amp;#39;,&amp;#39;password&amp;#39; =&amp;gt; &amp;#39;&amp;#39;,&amp;#39;charset&amp;#39; =&amp;gt; &amp;#39;utf8&amp;#39;,],],];SQL 查询 // 返回多行."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/yii-db/" />





<link rel="stylesheet" href="/assets/style.css" />

<link rel="stylesheet" href="/style.css" />


<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.2/build/styles/atom-one-dark.min.css">

<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="/favicon.png" />





<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Yii Db"/>
<meta name="twitter:description" content="Yii 包含了一个建立在 PHP PDO 之上的数据访问层 (DAO： Database Access Objects)。DAO为不同的数据库提供了一套统一的API。 其中 ActiveRecord 提供了数据库与模型(MVC 中的 M,Model) 的交互，QueryBuilder 用于创建动态的查询语句。 DAO提供了简单高效的SQL查询，可以用在与数据库交互的各个地方.
使用 Yii DAO 时，你主要需要处理纯 SQL 语句和 PHP 数组。因此，这是访问数据库最高效的方法。 然而，因为不同数据库之间的 SQL 语法往往是不同的， 使用 Yii DAO 也意味着你必须花些额外的工夫来创建一个”数据库无关“的应用。
连接数据库 // 连接数据库$db = new yii\db\Connection([&#39;dsn&#39; =&gt; &#39;mysql:host=localhost;dbname=example&#39;,&#39;username&#39; =&gt; &#39;root&#39;,&#39;password&#39; =&gt; &#39;&#39;,&#39;charset&#39; =&gt; &#39;utf8&#39;,]);return [&#39;components&#39; =&gt; [&#39;db&#39; =&gt; [&#39;class&#39; =&gt; &#39;yii\db\Connection&#39;,&#39;dsn&#39; =&gt; &#39;mysql:host=localhost;dbname=example&#39;,&#39;username&#39; =&gt; &#39;root&#39;,&#39;password&#39; =&gt; &#39;&#39;,&#39;charset&#39; =&gt; &#39;utf8&#39;,],],];SQL 查询 // 返回多行."/>



<meta property="og:title" content="Yii Db" />
<meta property="og:description" content="Yii 包含了一个建立在 PHP PDO 之上的数据访问层 (DAO： Database Access Objects)。DAO为不同的数据库提供了一套统一的API。 其中 ActiveRecord 提供了数据库与模型(MVC 中的 M,Model) 的交互，QueryBuilder 用于创建动态的查询语句。 DAO提供了简单高效的SQL查询，可以用在与数据库交互的各个地方.
使用 Yii DAO 时，你主要需要处理纯 SQL 语句和 PHP 数组。因此，这是访问数据库最高效的方法。 然而，因为不同数据库之间的 SQL 语法往往是不同的， 使用 Yii DAO 也意味着你必须花些额外的工夫来创建一个”数据库无关“的应用。
连接数据库 // 连接数据库$db = new yii\db\Connection([&#39;dsn&#39; =&gt; &#39;mysql:host=localhost;dbname=example&#39;,&#39;username&#39; =&gt; &#39;root&#39;,&#39;password&#39; =&gt; &#39;&#39;,&#39;charset&#39; =&gt; &#39;utf8&#39;,]);return [&#39;components&#39; =&gt; [&#39;db&#39; =&gt; [&#39;class&#39; =&gt; &#39;yii\db\Connection&#39;,&#39;dsn&#39; =&gt; &#39;mysql:host=localhost;dbname=example&#39;,&#39;username&#39; =&gt; &#39;root&#39;,&#39;password&#39; =&gt; &#39;&#39;,&#39;charset&#39; =&gt; &#39;utf8&#39;,],],];SQL 查询 // 返回多行." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/yii-db/" />
<meta property="article:published_time" content="2020-11-11T19:09:39+08:00" />
<meta property="article:modified_time" content="2020-11-11T19:09:39+08:00" /><meta property="og:site_name" content="Strawbreey Notes" />






  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    
    <span class="logo__text">
      Strawbreey Notes
    </span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/showcase">Showcase</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/showcase">Showcase</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Yii Db</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-11-11
        </span>

        
          
        
      

      


      
    </div>

    

    

    <div class="post-content">
      
      <p>Yii 包含了一个建立在 PHP PDO 之上的数据访问层 (DAO： Database Access Objects)。DAO为不同的数据库提供了一套统一的API。 其中 ActiveRecord 提供了数据库与模型(MVC 中的 M,Model) 的交互，QueryBuilder 用于创建动态的查询语句。 DAO提供了简单高效的SQL查询，可以用在与数据库交互的各个地方.</p>
<p>使用 Yii DAO 时，你主要需要处理纯 SQL 语句和 PHP 数组。因此，这是访问数据库最高效的方法。 然而，因为不同数据库之间的 SQL 语法往往是不同的， 使用 Yii DAO 也意味着你必须花些额外的工夫来创建一个”数据库无关“的应用。</p>
<h3 id="连接数据库">连接数据库</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// 连接数据库
$db = new yii\db\Connection([
    &#39;dsn&#39; =&gt; &#39;mysql:host=localhost;dbname=example&#39;,
    &#39;username&#39; =&gt; &#39;root&#39;,
    &#39;password&#39; =&gt; &#39;&#39;,
    &#39;charset&#39; =&gt; &#39;utf8&#39;,
]);

return [
    &#39;components&#39; =&gt; [
        &#39;db&#39; =&gt; [
            &#39;class&#39; =&gt; &#39;yii\db\Connection&#39;,
            &#39;dsn&#39; =&gt; &#39;mysql:host=localhost;dbname=example&#39;,
            &#39;username&#39; =&gt; &#39;root&#39;,
            &#39;password&#39; =&gt; &#39;&#39;,
            &#39;charset&#39; =&gt; &#39;utf8&#39;,
        ],
    ],
];
</code></pre></div><h3 id="sql-查询">SQL 查询</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">// 返回多行. 每行都是列名和值的关联数组.
// 如果该查询没有结果则返回空数组
$posts = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT * FROM post&#39;)
            -&gt;queryAll();

// 返回一行 (第一行)
// 如果该查询没有结果则返回 false
$post = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT * FROM post WHERE id=1&#39;)
           -&gt;queryOne();

// 返回一列 (第一列)
// 如果该查询没有结果则返回空数组
$titles = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT title FROM post&#39;)
             -&gt;queryColumn();

// 返回一个标量值
// 如果该查询没有结果则返回 false
$count = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT COUNT(*) FROM post&#39;)
             -&gt;queryScalar();
</code></pre></div><p>当使用带参数的 SQL 来创建数据库命令时， 你几乎总是应该使用绑定参数的方法来防止 SQL 注入攻击</p>
<p>bindValue()：绑定一个参数值
bindValues()：在一次调用中绑定多个参数值
bindParam()：与 bindValue() 相似，但是也支持绑定参数引用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$post = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT * FROM post WHERE id=:id AND status=:status&#39;)
           -&gt;bindValue(&#39;:id&#39;, $_GET[&#39;id&#39;])
           -&gt;bindValue(&#39;:status&#39;, 1)
           -&gt;queryOne();

$params = [&#39;:id&#39; =&gt; $_GET[&#39;id&#39;], &#39;:status&#39; =&gt; 1];

$post = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT * FROM post WHERE id=:id AND status=:status&#39;)
           -&gt;bindValues($params)
           -&gt;queryOne();
           
$post = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT * FROM post WHERE id=:id AND status=:status&#39;, $params)
           -&gt;queryOne();
</code></pre></div><p>绑定参数是通过 预处理语句 实现的。 除了防止 SQL 注入攻击，它也可以通过一次预处理 SQL 语句， 使用不同参数多次执行，来提升性能。例如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$command = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT * FROM post WHERE id=:id&#39;);

$post1 = $command-&gt;bindValue(&#39;:id&#39;, 1)-&gt;queryOne();
$post2 = $command-&gt;bindValue(&#39;:id&#39;, 2)-&gt;queryOne();
</code></pre></div><p>因为 bindParam() 支持通过引用来绑定参数， 上述代码也可以像下面这样写：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$command = Yii::$app-&gt;db-&gt;createCommand(&#39;SELECT * FROM post WHERE id=:id&#39;)
              -&gt;bindParam(&#39;:id&#39;, $id);

$id = 1;
$post1 = $command-&gt;queryOne();

$id = 2;
$post2 = $command-&gt;queryOne();
</code></pre></div><p>执行非查询语句</p>
<p>上面部分中介绍的 queryXyz() 方法都处理的是从数据库返回数据的查询语句。对于那些不取回数据的语句， 你应该调用的是 yii\db\Command::execute() 方法。例如，</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">Yii::$app-&gt;db-&gt;createCommand(&#39;UPDATE post SET status=1 WHERE id=1&#39;)
   -&gt;execute();
</code></pre></div><p>对于 INSERT, UPDATE 和 DELETE 语句，不再需要写纯SQL语句了， 你可以直接调用 insert()、update()、delete()， 来构建相应的 SQL 语句。这些方法将正确地引用表和列名称以及绑定参数值。例如,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">Yii::$app-&gt;db-&gt;createCommand()-&gt;insert(&#39;user&#39;, [
    &#39;name&#39; =&gt; &#39;Sam&#39;,
    &#39;age&#39; =&gt; 30,
])-&gt;execute();

// UPDATE (table name, column values, condition)
Yii::$app-&gt;db-&gt;createCommand()-&gt;update(&#39;user&#39;, [&#39;status&#39; =&gt; 1], &#39;age &gt; 30&#39;)-&gt;execute();

// DELETE (table name, condition)
Yii::$app-&gt;db-&gt;createCommand()-&gt;delete(&#39;user&#39;, &#39;status = 0&#39;)-&gt;execute();
</code></pre></div><p>你也可以调用 batchInsert() 来一次插入多行， 这比一次插入一行要高效得多：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">
// table name, column names, column values
Yii::$app-&gt;db-&gt;createCommand()-&gt;batchInsert(&#39;user&#39;, [&#39;name&#39;, &#39;age&#39;], [
    [&#39;Tom&#39;, 30],
    [&#39;Jane&#39;, 20],
    [&#39;Linda&#39;, 25],
])-&gt;execute();
</code></pre></div><p>另一个有用的方法是 upsert()。Upsert 是一种原子操作，如果它们不存在（匹配唯一约束），则将行插入到数据库表中， 或者在它们执行时更新它们：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">Yii::$app-&gt;db-&gt;createCommand()-&gt;upsert(&#39;pages&#39;, [
    &#39;name&#39; =&gt; &#39;Front page&#39;,
    &#39;url&#39; =&gt; &#39;http://example.com/&#39;, // url is unique
    &#39;visits&#39; =&gt; 0,
], [
    &#39;visits&#39; =&gt; new \yii\db\Expression(&#39;visits + 1&#39;),
], $params)-&gt;execute();

</code></pre></div><p>执行事务</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">Yii::$app-&gt;db-&gt;transaction(function($db) {
    $db-&gt;createCommand($sql1)-&gt;execute();
    $db-&gt;createCommand($sql2)-&gt;execute();
    // ... executing other SQL statements ...
});

// 上述代码等价于下面的代码，但是下面的代码给予了你对于错误处理代码的更多掌控：

$db = Yii::$app-&gt;db;
$transaction = $db-&gt;beginTransaction();
try {
    $db-&gt;createCommand($sql1)-&gt;execute();
    $db-&gt;createCommand($sql2)-&gt;execute();
    // ... executing other SQL statements ...
    
    $transaction-&gt;commit();
} catch(\Exception $e) {
    $transaction-&gt;rollBack();
    throw $e;
} catch(\Throwable $e) {
    $transaction-&gt;rollBack();
    throw $e;
}
</code></pre></div><p>嵌套事务</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">Yii::$app-&gt;db-&gt;transaction(function ($db) {
    // outer transaction
    
    $db-&gt;transaction(function ($db) {
        // inner transaction
    });
});

// 上述代码等价于下面的代码，但是下面的代码给予了你对于错误处理代码的更多掌控：


$db = Yii::$app-&gt;db;
$outerTransaction = $db-&gt;beginTransaction();
try {
    $db-&gt;createCommand($sql1)-&gt;execute();

    $innerTransaction = $db-&gt;beginTransaction();
    try {
        $db-&gt;createCommand($sql2)-&gt;execute();
        $innerTransaction-&gt;commit();
    } catch (\Exception $e) {
        $innerTransaction-&gt;rollBack();
        throw $e;
    } catch (\Throwable $e) {
        $innerTransaction-&gt;rollBack();
        throw $e;
    }

    $outerTransaction-&gt;commit();
} catch (\Exception $e) {
    $outerTransaction-&gt;rollBack();
    throw $e;
} catch (\Throwable $e) {
    $outerTransaction-&gt;rollBack();
    throw $e;
}

</code></pre></div><p>操纵数据库模式</p>
<p>Yii DAO 提供了一套完整的方法来让你操纵数据库模式， 如创建表、从表中删除一列，等等。这些方法罗列如下：</p>
<ul>
<li>createTable()：创建一张表</li>
<li>renameTable()：重命名一张表</li>
<li>dropTable()：删除一张表</li>
<li>truncateTable()：删除一张表中的所有行</li>
<li>addColumn()：增加一列</li>
<li>renameColumn()：重命名一列</li>
<li>dropColumn()：删除一列</li>
<li>alterColumn()：修改一列</li>
<li>addPrimaryKey()：增加主键</li>
<li>dropPrimaryKey()：删除主键</li>
<li>addForeignKey()：增加一个外键</li>
<li>dropForeignKey()：删除一个外键</li>
<li>createIndex()：增加一个索引</li>
<li>dropIndex()：删除一个索引
这些方法可以如下地使用：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">Yii::$app-&gt;db-&gt;createCommand()-&gt;createTable(&#39;post&#39;, [
    &#39;id&#39; =&gt; &#39;pk&#39;,
    &#39;title&#39; =&gt; &#39;string&#39;,
    &#39;text&#39; =&gt; &#39;text&#39;,
]);
</code></pre></div><p>查询构建器</p>
<p>查询构建器建立在 Database Access Objects 基础之上，可让你创建 程序化的、DBMS无关的SQL语句。相比于原生的SQL语句，查询构建器可以帮你 写出可读性更强的SQL相关的代码，并生成安全性更强的SQL语句。</p>
<p>使用查询构建器通常包含以下两个步骤：</p>
<ul>
<li>创建一个 yii\db\Query 对象来代表一条 SELECT SQL 语句的不同子句（例如 SELECT, FROM）。</li>
<li>执行 yii\db\Query 的一个查询方法（例如：all()）从数据库当中检索数据。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$rows = (new \yii\db\Query())
    -&gt;select([&#39;id&#39;, &#39;email&#39;])
    -&gt;from(&#39;user&#39;)
    -&gt;where([&#39;last_name&#39; =&gt; &#39;Smith&#39;])
    -&gt;limit(10)
    -&gt;all();
</code></pre></div><p>=&gt;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>, <span style="color:#f92672">`</span>email<span style="color:#f92672">`</span> 
<span style="color:#66d9ef">FROM</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>
<span style="color:#66d9ef">WHERE</span> <span style="color:#f92672">`</span>last_name<span style="color:#f92672">`</span> <span style="color:#f92672">=</span> :last_name
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span>

</code></pre></div><p>创建查询</p>
<p>select()</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$query-&gt;select([&#39;id&#39;, &#39;email&#39;]);
// 等同于：
$query-&gt;select(&#39;id, email&#39;);

$query-&gt;select([&#39;user.id AS user_id&#39;, &#39;email&#39;]);
// 等同于：
$query-&gt;select(&#39;user.id AS user_id, email&#39;);

$query-&gt;select([&#39;user_id&#39; =&gt; &#39;user.id&#39;, &#39;email&#39;]);

$query-&gt;select([&#34;CONCAT(first_name, &#39; &#39;, last_name) AS full_name&#34;, &#39;email&#39;]); 

$subQuery = (new Query())-&gt;select(&#39;COUNT(*)&#39;)-&gt;from(&#39;user&#39;);

// SELECT `id`, (SELECT COUNT(*) FROM `user`) AS `count` FROM `post`
$query = (new Query())-&gt;select([&#39;id&#39;, &#39;count&#39; =&gt; $subQuery])-&gt;from(&#39;post&#39;);

$query-&gt;select(&#39;user_id&#39;)-&gt;distinct();

$query-&gt;select([&#39;id&#39;, &#39;username&#39;])
    -&gt;addSelect([&#39;email&#39;]);
</code></pre></div><p>from()</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$query-&gt;from(&#39;user&#39;);

$query-&gt;from([&#39;public.user u&#39;, &#39;public.post p&#39;]);
// 等同于：
$query-&gt;from(&#39;public.user u, public.post p&#39;);

$query-&gt;from([&#39;u&#39; =&gt; &#39;public.user&#39;, &#39;p&#39; =&gt; &#39;public.post&#39;]);

$subQuery = (new Query())-&gt;select(&#39;id&#39;)-&gt;from(&#39;user&#39;)-&gt;where(&#39;status=1&#39;);
// SELECT * FROM (SELECT `id` FROM `user` WHERE status=1) u 
$query-&gt;from([&#39;u&#39; =&gt; $subQuery]);

</code></pre></div>
    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/posts/odbc/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Odbc</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/posts/yii-http-cache/">
                  <span class="button__text">Yii Http Cache</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">Copyright©2019-2020 Strawbreey. All Rights Reserved</div>
      
  </div>
</footer>

<script src="/assets/main.js"></script>

<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.3.2/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


      
    </div>

    
  </body>
</html>
